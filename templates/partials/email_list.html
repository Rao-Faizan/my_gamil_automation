<!-- Sort and Filter Controls -->
<div class="mb-4 flex flex-wrap items-center gap-4">
  <select class="border rounded px-3 py-1.5 text-sm" onchange="sortEmails(this.value)">
    <option value="date_desc">Newest First</option>
    <option value="date_asc">Oldest First</option>
    <option value="sender">By Sender</option>
    <option value="subject">By Subject</option>
  </select>
  
  <div class="flex items-center gap-2">
    <input type="checkbox" id="selectAll" class="rounded">
    <label for="selectAll" class="text-sm">Select All</label>
  </div>
</div>

{% for email in emails %}
  <div class="p-4 bg-white rounded-lg shadow-sm mb-3 hover:shadow-md transition-shadow duration-200">
    <div class="flex items-start gap-4">
      <!-- Checkbox and Priority -->
      <div class="flex flex-col items-center gap-2">
        <input type="checkbox" class="email-checkbox rounded" value="{{ email.message_id | safe }}">
        <i class="fas fa-star text-gray-300 hover:text-yellow-400 cursor-pointer"></i>
      </div>

      <!-- Email Content -->
      <div class="flex-1">
        <div class="flex justify-between items-start mb-2">
          <div class="text-sm">
            <p class="font-semibold text-gray-900">{{ email.sender | safe }}</p>
            <p class="font-medium text-gray-800">{{ email.subject | safe }}</p>
          </div>
          <div class="text-xs text-gray-500">
            {{ email.email_date | safe }}
          </div>
        </div>

        <!-- Preview and Tags -->
        <div class="text-sm text-gray-600 mb-2 line-clamp-2">
          {{ email.preview if email.preview else '' }}
        </div>
        
        <!-- Status Badge and Metadata -->
        <div class="flex items-center gap-3 text-xs text-gray-500 mb-3">
          <span class="px-2 py-1 rounded-full {{ 'bg-blue-100 text-blue-800' if email.status == 'unread' else 'bg-gray-100' }}">
            {{ email.status | safe }}
          </span>
          {% if email.attachments %}
            <span title="Has attachments">
              <i class="fas fa-paperclip"></i>
              {{ email.attachments | length }}
            </span>
          {% endif %}
        </div>

        <!-- Actions -->
        <div class="flex flex-wrap items-center gap-2">
          <a href="/view/{{ email.message_id | safe }}" 
             class="inline-flex items-center gap-1 bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1.5 rounded text-sm">
            <i class="fas fa-eye"></i>
            View
          </a>
          {% if email.status not in ['sent', 'no-reply'] %}
            <form action="/generate_reply" method="post" class="inline">
              <input type="hidden" name="sender" value="{{ email.sender | safe }}">
              <input type="hidden" name="subject" value="{{ email.subject | safe }}">
              <input type="hidden" name="original_body" value="{{ email.original_body | safe }}">
              <input type="hidden" name="message_id" value="{{ email.message_id | safe }}">
              <button class="inline-flex items-center gap-1 bg-green-600 hover:bg-green-700 text-white px-3 py-1.5 rounded text-sm">
                <i class="fas fa-reply"></i>
                Generate Reply
              </button>
            </form>
          {% endif %}
          <form action="/delete_email" method="post" class="inline">
            <input type="hidden" name="message_id" value="{{ email.message_id | safe }}">
            <button type="submit" 
                    onclick="return confirm('Are you sure you want to delete this email?')"
                    class="inline-flex items-center gap-1 bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded text-sm">
              <i class="fas fa-trash"></i>
              Delete
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endfor %}

<!-- Bulk Actions for Selected Emails -->
<div id="bulkActions" class="hidden fixed bottom-0 left-0 right-0 bg-white shadow-lg border-t p-4">
  <div class="max-w-6xl mx-auto flex justify-between items-center">
    <span class="text-sm"><span id="selectedCount">0</span> emails selected</span>
    <div class="flex gap-2">
      <button class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">
        Mark as Read
      </button>
      <button class="bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700">
        Delete Selected
      </button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const selectAll = document.getElementById('selectAll');
  const checkboxes = document.querySelectorAll('.email-checkbox');
  const bulkActions = document.getElementById('bulkActions');
  const selectedCount = document.getElementById('selectedCount');

  function updateBulkActionsVisibility() {
    const checkedBoxes = document.querySelectorAll('.email-checkbox:checked');
    bulkActions.classList.toggle('hidden', checkedBoxes.length === 0);
    selectedCount.textContent = checkedBoxes.length;
  }

  selectAll.addEventListener('change', function() {
    checkboxes.forEach(checkbox => checkbox.checked = this.checked);
    updateBulkActionsVisibility();
  });

  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', updateBulkActionsVisibility);
  });
});

function sortEmails(value) {
  // Implementation would go here - you'll need to add backend support for this
  console.log('Sorting by:', value);
}
</script>