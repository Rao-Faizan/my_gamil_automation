{% extends "base.html" %}
{% block content %}
<div class="p-6 max-w-6xl mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-gray-800">ðŸ“¨ Email Dashboard</h1>

  {% if message %}
    <div class="mb-4 px-4 py-2 rounded text-white {{ 'bg-green-600' if message_type == 'success' else 'bg-red-600' }}">
      {{ message | safe }}
    </div>
  {% endif %}

  <!-- Upload CSV Form -->
  <form action="/upload_csv" method="post" enctype="multipart/form-data" class="mb-6 flex items-center gap-4">
    <input type="file" name="file" accept=".csv" class="block p-2 border rounded w-full md:w-auto">
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Upload CSV</button>
  </form>

  <!-- Tabs -->
  <div class="flex gap-4 mb-6 border-b pb-2 text-sm font-medium">
    <button onclick="showTab('unread')" class="px-4 py-2 bg-gray-100 hover:bg-blue-100 text-blue-700 rounded">Unread</button>
    <button onclick="showTab('sent')" class="px-4 py-2 bg-gray-100 hover:bg-blue-100 text-blue-700 rounded">Sent</button>
    <button onclick="showTab('draft')" class="px-4 py-2 bg-gray-100 hover:bg-blue-100 text-blue-700 rounded">Draft</button>
    <button onclick="showTab('no_reply')" class="px-4 py-2 bg-gray-100 hover:bg-blue-100 text-blue-700 rounded">No-Reply</button>
  </div>

  <!-- Tab: Unread -->
  <div id="tab-unread" class="tab-content">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">Unread Emails ({{ unread_emails|length }})</h2>
    <form action="/delete_all_emails" method="post" class="mb-4">
      <input type="hidden" name="category" value="unread">
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" onclick="return confirm('Are you sure you want to delete all unread emails?')">Delete All Unread</button>
    </form>
    {% set emails = unread_emails %}
    {% include 'partials/email_list.html' with context %}
  </div>

  <!-- Tab: Sent -->
  <div id="tab-sent" class="tab-content hidden">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">Sent Emails ({{ sent_emails|length }})</h2>
    <form action="/delete_all_emails" method="post" class="mb-4">
      <input type="hidden" name="category" value="sent">
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" onclick="return confirm('Are you sure you want to delete all sent emails?')">Delete All Sent</button>
    </form>
    {% set emails = sent_emails %}
    {% include 'partials/email_list.html' with context %}
  </div>

  <!-- Tab: Draft -->
  <div id="tab-draft" class="tab-content hidden">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">Draft Emails ({{ draft_emails|length }})</h2>
    <form action="/delete_all_emails" method="post" class="mb-4">
      <input type="hidden" name="category" value="draft">
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" onclick="return confirm('Are you sure you want to delete all draft emails?')">Delete All Draft</button>
    </form>
    {% set emails = draft_emails %}
    {% include 'partials/email_list.html' with context %}
  </div>

  <!-- Tab: No Reply -->
  <div id="tab-no_reply" class="tab-content hidden">
    <h2 class="text-xl font-semibold text-gray-700 mb-3">No-Reply Emails ({{ no_reply_emails|length }})</h2>
    <form action="/delete_all_emails" method="post" class="mb-4">
      <input type="hidden" name="category" value="no-reply">
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" onclick="return confirm('Are you sure you want to delete all no-reply emails?')">Delete All No-Reply</button>
    </form>
    {% set emails = no_reply_emails %}
    {% include 'partials/email_list.html' with context %}
  </div>

  <!-- Delete All Emails -->
  <form action="/delete_all_emails" method="post" class="mt-8">
    <input type="hidden" name="category" value="all">
    <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700" onclick="return confirm('Are you sure you want to delete all emails?')">Delete All Emails</button>
  </form>

  <div class="mt-8">
    <a href="/bulk" class="text-blue-600 underline">ðŸ“¤ Go to Bulk Send</a>
  </div>
</div>

<!-- Tabs Script -->
<script>
  function showTab(tabName) {
    const tabs = ['unread', 'sent', 'draft', 'no_reply'];
    tabs.forEach(t => {
      document.getElementById('tab-' + t).classList.add('hidden');
    });
    document.getElementById('tab-' + tabName).classList.remove('hidden');
  }

  // Show unread by default
  showTab('unread');
</script>
{% endblock %}